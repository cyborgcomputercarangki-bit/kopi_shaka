<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POS System - CRISPY CHICK & KOPI SHAKA</title>
    <style>
        /* FONT DAN RESET DASAR */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background-color: #f8f8f8; display: flex; flex-direction: column; height: 100vh; }
        
        /* HEADER */
        .header { background-color: #5c3b1a; color: white; padding: 15px 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.2); display: flex; justify-content: space-between; align-items: center; }
        .header h1 { margin: 0; font-size: 1.5em; }

        /* LAYOUT UTAMA (MAIN) */
        .main-content { display: flex; flex: 1; overflow: hidden; }
        
        /* KOLOM KIRI: MENU & KATEGORI */
        .menu-sidebar { flex: 3; background-color: white; padding: 15px; border-right: 1px solid #ddd; display: flex; flex-direction: column; }
        .category-tabs { display: flex; flex-wrap: wrap; margin-bottom: 15px; gap: 8px; }
        .category-button { 
            padding: 8px 15px; 
            border: 1px solid #ccc; 
            background-color: #eee; 
            cursor: pointer; 
            border-radius: 4px; 
            font-size: 0.9em; 
            transition: background-color 0.2s;
        }
        .category-button:hover, .category-button.active { 
            background-color: #8B4513; 
            color: white; 
            border-color: #8B4513;
        }
        
        .menu-items-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); 
            gap: 15px; 
            overflow-y: auto; 
            padding-right: 10px; /* Ruang untuk scrollbar */
            flex: 1;
        }
        .menu-item { 
            background-color: #fff; 
            border: 1px solid #ccc; 
            padding: 10px; 
            text-align: center; 
            cursor: pointer; 
            border-radius: 8px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.05); 
            transition: transform 0.1s;
        }
        .menu-item:active { transform: scale(0.98); }
        .menu-item img {
            width: 100%;
            height: 90px; /* Tinggi gambar yang seragam */
            object-fit: cover; /* Memastikan gambar mengisi area tanpa terdistorsi */
            border-radius: 4px;
            margin-bottom: 8px;
        }
        .item-name { font-weight: bold; font-size: 0.95em; margin-bottom: 5px; }
        .item-price { color: #5c3b1a; font-size: 1.1em; }
        .hidden { display: none; }

        /* KOLOM KANAN: PESANAN */
        .order-area { flex: 1.5; background-color: #fffaf0; display: flex; flex-direction: column; padding: 15px; }
        .order-area h2 { margin-top: 0; color: #8B4513; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
        
        #order-list { list-style: none; padding: 0; margin: 0; flex: 1; overflow-y: auto; }
        #order-list li { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 10px 0; 
            border-bottom: 1px dashed #e0e0e0;
        }
        .order-item-detail { flex-grow: 1; }
        .order-item-qty { font-weight: bold; margin-right: 15px; color: #8B4513; }
        .order-item-name { font-size: 0.9em; }
        .remove-btn { 
            background-color: #c9302c; 
            color: white; 
            border: none; 
            padding: 4px 8px; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 0.8em; 
            margin-left: 10px;
        }

        /* TOTAL DAN TOMBOL AKSI */
        .summary-total { margin-top: 15px; padding: 15px 0; border-top: 2px solid #8B4513; }
        .summary-total div { display: flex; justify-content: space-between; font-size: 1.2em; font-weight: bold; }
        
        .action-buttons { display: flex; gap: 10px; padding-top: 10px; }
        .action-buttons button { 
            flex: 1; 
            padding: 15px; 
            border: none; 
            border-radius: 5px; 
            color: white; 
            font-weight: bold; 
            cursor: pointer; 
            transition: background-color 0.2s;
        }
        #process-order-btn { background-color: #4CAF50; } /* Hijau */
        #process-order-btn:hover { background-color: #45a049; }
        #clear-order-btn { background-color: #f44336; } /* Merah */
        #clear-order-btn:hover { background-color: #da190b; }
    </style>
</head>
<body>

    <div class="header">
        <h1>POS System | CRISPY CHICK & KOPI SHAKA</h1>
        </div>

    <div class="main-content">
        
        <div class="menu-sidebar">
            <h2>Pilih Menu</h2>
            
            <div class="category-tabs" id="category-tabs">
                </div>

            <div class="menu-items-grid" id="menu-items-grid">
                </div>
        </div>

        <div class="order-area">
            <h2>ðŸ§¾ Pesanan Pelanggan</h2>
            
            <ul id="order-list">
                </ul>

            <div class="summary-total">
                <div>
                    <span>TOTAL</span>
                    <span id="total-display">Rp 0</span>
                </div>
            </div>

            <div class="action-buttons">
                <button id="clear-order-btn">BATALKAN</button>
                <button id="process-order-btn">PROSES PEMBAYARAN</button>
            </div>
        </div>

    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        // Konfigurasi Firebase dari akun Anda
        const firebaseConfig = {
            apiKey: "AIzaSyAf4pkzvpCuzmXquzIoCDXLAr6-_l3i8O0",
            authDomain: "kopi-shaka.firebaseapp.com",
            projectId: "kopi-shaka",
            storageBucket: "kopi-shaka.firebasestorage.app",
            messagingSenderId: "947498895962",
            appId: "1:947498895962:web:ebb8bc420bdbc47e086663"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const db = app.firestore();
    </script>

    <script>
        // Data Menu Anda (Disusun ulang untuk mendukung fitur Kategori dan Gambar)
        const allMenuItems = {
            'Ayam Crispy': [
                { name: "Dada Crispy", price: 12000, category: "Ayam Crispy", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Paha Atas Crispy", price: 12000, category: "Ayam Crispy", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Paha Bawah Crispy", price: 12000, category: "Ayam Crispy", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Sayap Dada Crispy", price: 12000, category: "Ayam Crispy", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Paket Ayam Crispy + Es Teh", price: 20000, category: "Ayam Crispy", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
            ],
            'Ayam Geprek': [
                { name: "Dada Geprek", price: 12000, category: "Ayam Geprek", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Paha Atas Geprek", price: 12000, category: "Ayam Geprek", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Paha Bawah Geprek", price: 12000, category: "Ayam Geprek", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Sayap Dada Geprek", price: 12000, category: "Ayam Geprek", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Paket Ayam Geprek + Es Teh", price: 20000, category: "Ayam Geprek", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
            ],
            'Makanan Lain': [
                { name: "Bakso Goreng Crispy", price: 10000, category: "Makanan Lain", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Bakso Geprek", price: 10000, category: "Makanan Lain", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Telur Goreng Crispy", price: 8000, category: "Makanan Lain", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Telur Geprek", price: 10000, category: "Makanan Lain", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Tempe / Tahu Geprek", price: 10000, category: "Makanan Lain", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Kentang Goreng", price: 13000, category: "Makanan Lain", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Nasi Putih", price: 5000, category: "Makanan Lain", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
            ],
            'Kopi': [
                { name: "Kopi Hitam (H)", price: 8000, category: "Kopi", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Americano (H/C)", price: 10000, category: "Kopi", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Es Kopi Susu Jadoel", price: 13000, category: "Kopi", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Kopi Susu Gula Aren (H/C)", price: 13000, category: "Kopi", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Cappuccino (H/C)", price: 13000, category: "Kopi", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Kopi Vanilla (H/C)", price: 13000, category: "Kopi", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
            ],
            'Non-Kopi & Teh': [
                { name: "Teh (H/C)", price: 5000, category: "Non-Kopi & Teh", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Thai Tea (H/C)", price: 13000, category: "Non-Kopi & Teh", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Milo (H/C)", price: 13000, category: "Non-Kopi & Teh", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Chocolate (C)", price: 13000, category: "Non-Kopi & Teh", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Milkshake Cokelat (C)", price: 13000, category: "Non-Kopi & Teh", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Manggo Squash (C)", price: 13000, category: "Non-Kopi & Teh", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Air Mineral Botol", price: 5000, category: "Non-Kopi & Teh", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
            ],
            'Snack Kopi Shaka': [
                { name: "Indomie Goreng Jumbo + Telur", price: 12000, category: "Snack Kopi Shaka", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Roti Bakar Cokelat", price: 10000, category: "Snack Kopi Shaka", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Pisang Goreng Kambeng Original", price: 10000, category: "Snack Kopi Shaka", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
                { name: "Bakso Bakar", price: 10000, category: "Snack Kopi Shaka", img: "https://generativelanguage.googleapis.com/v1beta/models/image-gemini/generateContent" },
            ]
        };

        const categories = Object.keys(allMenuItems);
        let currentOrder = [];
        const orderList = document.getElementById('order-list');
        const totalDisplay = document.getElementById('total-display');
        const menuGrid = document.getElementById('menu-items-grid');
        const categoryTabs = document.getElementById('category-tabs');
        const processButton = document.getElementById('process-order-btn');
        const clearButton = document.getElementById('clear-order-btn');


        // FUNGSI 1: MENGGAMBAR KATEGORI DAN MENU
        function renderMenu() {
            // Render Tombol Kategori
            categoryTabs.innerHTML = '';
            categories.forEach(category => {
                const button = document.createElement('button');
                button.textContent = category;
                button.className = 'category-button';
                button.setAttribute('data-category', category);
                button.addEventListener('click', () => filterMenu(category));
                categoryTabs.appendChild(button);
            });

            // Otomatis tampilkan kategori pertama saat inisialisasi
            if (categories.length > 0) {
                filterMenu(categories[0]);
            }
        }

        // FUNGSI 2: FILTER MENU BERDASARKAN KATEGORI
        function filterMenu(selectedCategory) {
            menuGrid.innerHTML = '';
            
            // Atur status aktif pada tombol kategori
            document.querySelectorAll('.category-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-category') === selectedCategory) {
                    btn.classList.add('active');
                }
            });

            // Tampilkan item menu yang sesuai
            const items = allMenuItems[selectedCategory] || [];
            items.forEach(item => {
                const menuItem = document.createElement('div');
                menuItem.className = 'menu-item';
                menuItem.innerHTML = `
                    <img src="${item.img}" alt="${item.name}">
                    <div class="item-name">${item.name}</div>
                    <div class="item-price">Rp ${item.price.toLocaleString('id-ID')}</div>
                `;
                menuItem.addEventListener('click', () => addToOrder(item.name, item.price));
                menuGrid.appendChild(menuItem);
            });
        }
        
        // FUNGSI 3: MENGUPDATE TAMPILAN PESANAN
        function updateOrderDisplay() {
            orderList.innerHTML = '';
            let total = 0;

            currentOrder.forEach((item, index) => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;

                const listItem = document.createElement('li');
                listItem.innerHTML = `
                    <div class="order-item-detail">
                        <div class="order-item-name">${item.name}</div>
                    </div>
                    <span class="order-item-qty">${item.quantity} x</span>
                    <span>Rp ${itemTotal.toLocaleString('id-ID')}</span>
                    <button class="remove-btn" onclick="removeItem(${index})">Hapus</button>
                `;
                orderList.appendChild(listItem);
            });

            totalDisplay.textContent = `Rp ${total.toLocaleString('id-ID')}`;
        }
        
        // FUNGSI 4: TAMBAH/UPDATE PESANAN (sama seperti sebelumnya)
        function addToOrder(name, price) {
            const existingItem = currentOrder.find(item => item.name === name);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                currentOrder.push({ name: name, price: price, quantity: 1 });
            }
            updateOrderDisplay();
        }

        // FUNGSI 5: HAPUS ITEM (dipanggil dari tombol Hapus)
        window.removeItem = function(index) {
            currentOrder.splice(index, 1);
            updateOrderDisplay();
        };

        // FUNGSI 6: PROSES PEMBAYARAN (Integrasi Firebase)
        processButton.addEventListener('click', async () => {
            const total = currentOrder.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            if (total > 0) {
                const transactionData = {
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    totalAmount: total,
                    items: currentOrder,
                    status: "Selesai"
                };
                
                try {
                    const docRef = await db.collection("transaksi").add(transactionData);
                    alert(`Transaksi berhasil! Total: Rp ${total.toLocaleString('id-ID')}. ID Transaksi: ${docRef.id}`);
                    currentOrder = []; 
                    updateOrderDisplay();
                } catch (error) {
                    console.error("Error saat menyimpan transaksi:", error);
                    alert("Gagal menyimpan transaksi ke database.");
                }
            } else {
                alert('Tidak ada item dalam pesanan!');
            }
        });
        
        // FUNGSI 7: BATAL PESANAN
        clearButton.addEventListener('click', () => {
            if (currentOrder.length > 0 && confirm("Apakah Anda yakin ingin membatalkan semua pesanan saat ini?")) {
                currentOrder = [];
                updateOrderDisplay();
            }
        });

        // INISIALISASI
        renderMenu();
        updateOrderDisplay();
    </script>
</body>
</html>
